<div class="relative flex flex-col min-w-0 overflow-y-auto bg-gray-50 p-6 rounded-lg shadow-sm h-[70vh]">
    <!-- Search Form -->
    <div class="bg-white p-6 rounded-md shadow hover:shadow-md transition-shadow duration-200 border-l-4 border-indigo-600 mb-6">
        <div class="text-lg font-semibold text-gray-800 flex items-center gap-2 bg-white/80 shadow-sm rounded-md p-2 animate-fade-in-up">
            <mat-icon class="icon-size-5 text-indigo-600 animate-pulse" [svgIcon]="'heroicons_solid:search'"></mat-icon>
            Search Agencies
        </div>
        <div class="text-gray-500 text-sm mt-1">Filter agencies by name, email, code, region, or city.</div>
        <div [formGroup]="searchForm" class="flex flex-col md:flex-row items-center gap-4 mt-4">
            <!-- Global Search Input Field -->
            <mat-form-field class="fuse-mat-dense fuse-mat-rounded w-full md:w-1/3" [subscriptSizing]="'dynamic'">
                <mat-label class="text-gray-700 text-sm">Search...</mat-label>
                <mat-icon class="icon-size-5 text-indigo-500 animate-pulse" matPrefix [svgIcon]="'heroicons_solid:search'"></mat-icon>
                <input matInput formControlName="globalSearch" placeholder="Search by name, email, or code" autocomplete="off" class="text-sm">
            </mat-form-field>

            <!-- Region Select Dropdown -->
            <mat-form-field class="fuse-mat-dense fuse-mat-rounded w-full md:w-1/3" [subscriptSizing]="'dynamic'">
                <mat-label class="text-gray-700 text-sm">Select Region</mat-label>
                <mat-icon class="icon-size-5 text-indigo-500 animate-pulse" matPrefix [svgIcon]="'heroicons_solid:map'"></mat-icon>
                <mat-select formControlName="region" (selectionChange)="updateCitiesForRegion($event.value)" class="text-sm">
                    <mat-option value="">All Regions</mat-option>
                    <mat-option *ngFor="let region of regions" [value]="region">{{ region }}</mat-option>
                </mat-select>
            </mat-form-field>

            <!-- City Select Dropdown -->
            <mat-form-field class="fuse-mat-dense fuse-mat-rounded w-full md:w-1/3" [subscriptSizing]="'dynamic'">
                <mat-label class="text-gray-700 text-sm">Select City</mat-label>
                <mat-icon class="icon-size-5 text-indigo-500 animate-pulse" matPrefix [svgIcon]="'heroicons_solid:map-pin'"></mat-icon>
                <mat-select formControlName="city" class="text-sm">
                    <mat-option value="">All Cities</mat-option>
                    <mat-option *ngFor="let city of availableCities" [value]="city">{{ city }}</mat-option>
                </mat-select>
            </mat-form-field>
        </div>
    </div>

    <!-- Table Section -->
<!-- Table Container -->
<div class="bg-white dark:bg-gray-900 p-6 rounded-xl border border-gray-200 dark:border-gray-800">
  <!-- Header -->
  <div class="flex justify-between items-center mb-4">
    <div class="flex items-center gap-2 text-lg font-semibold text-gray-800 dark:text-gray-100">
      <mat-icon class="text-indigo-600">business</mat-icon>
      Agency Management
    </div>
  </div>

  <!-- Subtext -->
  <div class="text-gray-500 dark:text-gray-400 text-sm mb-3">
    Manage agency data and control user activation status.
  </div>

  <!-- Empty State -->
  <div *ngIf="filteredAgencies.length === 0" class="text-gray-500 text-sm mt-6 text-center">
    No agencies available.
  </div>

  <!-- Table -->
  <div class="overflow-x-auto border border-gray-200 dark:border-gray-800 rounded-lg">
    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700 text-sm">
      <thead class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">
        <tr>
          <th class="px-4 py-2 text-left font-medium">Agency</th>
          <th class="px-4 py-2 text-left font-medium">Code</th>
          <th class="px-4 py-2 text-left font-medium">City</th>
          <th class="px-4 py-2 text-left font-medium">Region</th>
          <th class="px-4 py-2 text-left font-medium">Users</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100 dark:divide-gray-800">
        <tr *ngFor="let agency of paginatedAgencies; let i = index"
            [ngClass]="i % 2 === 0 ? 'bg-white dark:bg-gray-900' : 'bg-gray-50 dark:bg-gray-950'">

          <!-- Agency Name -->
          <td class="px-4 py-3 font-medium text-gray-900 dark:text-gray-100 whitespace-nowrap">
            {{ agency.agencyName }}
          </td>

          <!-- Code -->
          <td class="px-4 py-3 text-gray-600 dark:text-gray-300 whitespace-nowrap">
            {{ agency.agencyCode }}
          </td>

          <!-- City -->
          <td class="px-4 py-3 text-gray-600 dark:text-gray-300 whitespace-nowrap">
            {{ agency.city }}
          </td>

          <!-- Region -->
          <td class="px-4 py-3 text-gray-600 dark:text-gray-300 whitespace-nowrap">
            {{ agency.region }}
          </td>

          <!-- Users + Toggle -->
          <td class="px-4 py-3 align-top">
            <div class="flex flex-col gap-1 max-h-40 overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-gray-400 dark:scrollbar-thumb-gray-600 scrollbar-track-gray-100 dark:scrollbar-track-gray-800">
              <div *ngFor="let uid of agency.userIds; let i = index"
                   class="flex items-center justify-between gap-2 border border-gray-200 dark:border-gray-700 rounded px-2 py-1 text-xs">

                <div class="flex items-center gap-1 text-gray-700 dark:text-gray-300 truncate max-w-[120px]">
                  <span class="material-icons text-gray-400 text-[14px]">person</span>
                  {{ agency.users[i] }}
                </div>

                <label class="inline-flex items-center cursor-pointer">
                  <input type="checkbox"
                         class="sr-only peer"
                         [checked]="agency.statuses[i]"
                         (change)="toggleActivation({ userId: uid, status: !agency.statuses[i], agencyId: agency.id })">
                  <div class="relative w-8 h-4 bg-gray-300 dark:bg-gray-700 rounded-full peer peer-checked:after:translate-x-4 
                              after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-3 after:w-3 after:transition-all 
                              peer-checked:bg-indigo-600"></div>
                </label>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <mat-paginator
    [length]="filteredAgencies.length"
    [pageSize]="pageSize"
    [pageSizeOptions]="[5, 10, 20, 50]"
    (page)="paginator.page.emit($event)"
    class="mt-3 bg-gray-50 dark:bg-gray-900 rounded-b-md text-gray-600 dark:text-gray-300 border-t border-gray-200 dark:border-gray-800">
  </mat-paginator>
</div>


</div>
