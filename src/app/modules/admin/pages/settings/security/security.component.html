<!-- Loading bar -->
<fuse-loading-bar class="bg-indigo-600 h-1 shadow-md backdrop-blur-sm"></fuse-loading-bar>

<div class="relative flex flex-col min-w-0 overflow-y-auto bg-gray-50 p-6 rounded-lg shadow-sm h-[70vh]">
    <!-- Form Container -->
    <form [formGroup]="securityForm" class="space-y-8">
        <!-- Alerts -->
        <div class="w-full space-y-3 mb-4">
            <fuse-alert *ngIf="successMessage" [type]="'success'" [appearance]="'outline'" class="animate-slide-in text-sm">
                <span fuseAlertTitle class="flex items-center gap-1">
                    <mat-icon class="icon-size-4 text-green-600" [svgIcon]="'heroicons_solid:check-circle'"></mat-icon>
                    Success
                </span>
                {{ successMessage }}
            </fuse-alert>
            <fuse-alert *ngIf="errorMessage" [type]="'warn'" [appearance]="'outline'" class="animate-slide-in text-sm">
                <span fuseAlertTitle class="flex items-center gap-1">
                    <mat-icon class="icon-size-4 text-yellow-600" [svgIcon]="'heroicons_solid:exclamation-triangle'"></mat-icon>
                    Warning
                </span>
                {{ errorMessage }}
            </fuse-alert>
        </div>

        <!-- Update Your Password Section -->
        <div class="bg-white p-6 rounded-md shadow hover:shadow-md transition-shadow duration-200 border-l-4 border-indigo-600">
            <div class="text-lg font-semibold text-gray-800 flex items-center gap-2 bg-white/80 shadow-sm rounded-md p-2 animate-fade-in-up">
                <mat-icon class="icon-size-5 text-indigo-600 animate-pulse" [svgIcon]="'heroicons_solid:lock-closed'"></mat-icon>
                Update Your Password
            </div>
            <div class="text-gray-500 text-sm mt-1">Enhance your account security by updating your password with a strong, unique combination.</div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
                    <mat-label class="text-gray-700 text-sm">Current Password</mat-label>
                    <mat-icon class="icon-size-5 text-indigo-500 animate-pulse" [svgIcon]="'heroicons_solid:lock-closed'" matPrefix></mat-icon>
                    <input
                        [formControlName]="'currentPasswordsuper'"
                        [type]="showCurrentPassword ? 'text' : 'password'"
                        matInput
                        class="text-sm">
                    <button mat-icon-button matSuffix (click)="showCurrentPassword = !showCurrentPassword" type="button" matTooltip="Toggle visibility">
                        <mat-icon class="text-indigo-500 icon-size-4">{{ showCurrentPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                    </button>
                    <mat-error *ngIf="securityForm.get('currentPasswordsuper')?.hasError('required') && securityForm.get('currentPasswordsuper')?.touched" class="text-sm">
                        Required
                    </mat-error>
                </mat-form-field>
                <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
                    <mat-label class="text-gray-700 text-sm">New Password</mat-label>
                    <mat-icon class="icon-size-5 text-indigo-500 animate-pulse" [svgIcon]="'heroicons_solid:lock-closed'" matPrefix></mat-icon>
                    <input
                        [formControlName]="'newPasswordsuper'"
                        [type]="showNewPassword ? 'text' : 'password'"
                        matInput
                        class="text-sm">
                    <button mat-icon-button matSuffix (click)="showNewPassword = !showNewPassword" type="button" matTooltip="Toggle visibility">
                        <mat-icon class="text-indigo-500 icon-size-4">{{ showNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                    </button>
                    <mat-error *ngIf="securityForm.get('newPasswordsuper')?.hasError('required') && securityForm.get('newPasswordsuper')?.touched" class="text-sm">
                        Required
                    </mat-error>
                    <mat-error *ngIf="securityForm.get('newPasswordsuper')?.hasError('passwordComplexity') && securityForm.get('newPasswordsuper')?.touched" class="text-sm">
                        Must be 8+ characters, mixed case, numbers, and symbols
                    </mat-error>
                </mat-form-field>
            </div>
            <div class="mt-2 text-sm text-gray-500">Minimum 8 characters, including letters, numbers, and special characters.</div>
            <div class="flex items-center justify-end mt-4 space-x-3">
                <button
                    mat-stroked-button
                    type="button"
                    class="px-4 py-2 border-indigo-500 text-indigo-600 hover:bg-indigo-50 transition duration-200 text-sm"
                    (click)="onCancel()">
                    Cancel
                </button>
                <button
                    mat-flat-button
                    type="button"
                    class="px-4 py-2 bg-indigo-600 text-white hover:bg-indigo-700 transition duration-200 text-sm"
                    [disabled]="!securityForm.valid || securityForm.get('newPasswordsuper')?.hasError('passwordComplexity')"
                    (click)="onChangePasswordSuperAdmin()">
                    Save
                </button>
            </div>
        </div>

        <!-- Generate Secure Password Section (SuperAdmin) -->
        <div class="bg-white p-6 rounded-md shadow hover:shadow-md transition-shadow duration-200 border-l-4 border-indigo-600">
            <div class="text-lg font-semibold text-gray-800 flex items-center gap-2 bg-white/80 shadow-sm rounded-md p-2 animate-fade-in-up">
                <mat-icon class="icon-size-5 text-indigo-600 animate-pulse" [svgIcon]="'heroicons_solid:key'"></mat-icon>
                Generate Secure Password (SuperAdmin)
            </div>
            <div class="text-gray-500 text-sm mt-1">Create a random password for enhanced security if you forget your current one (SuperAdmin only).</div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                <div class="w-full">
                    <div class="border border-gray-200 rounded-md p-4 bg-gray-50 flex justify-between items-center hover:bg-gray-100 transition-all duration-200">
                        <div class="flex items-center">
                            <mat-icon class="icon-size-5 text-indigo-500 animate-pulse" [svgIcon]="'heroicons_solid:key'"></mat-icon>
                            <span class="text-gray-800 text-sm ml-2">{{ generatedPasswordsuper || 'Generate a new password' }}</span>
                        </div>
                        <button class="text-indigo-600 hover:text-indigo-800 transition duration-200" (click)="copyToClipboard(generatedPasswordsuper)" matTooltip="Copy to clipboard">
                            <mat-icon class="icon-size-4" [svgIcon]="'heroicons_solid:clipboard'"></mat-icon>
                        </button>
                    </div>
                </div>
                <div class="flex items-center justify-end">
                    <button
                        mat-flat-button
                        type="button"
                        class="px-4 py-2 bg-indigo-600 text-white hover:bg-indigo-700 transition duration-200 text-sm"
                        (click)="onGenerateRandomPassword()">
                        Generate
                    </button>
                </div>
            </div>
            <div *ngIf="successMessagech" class="mt-2 text-green-600 text-sm">{{ successMessagech }}</div>
            <div *ngIf="errorMessagech" class="mt-2 text-red-600 text-sm">{{ errorMessagech }}</div>
        </div>

        <!-- Separator -->
        <div class="my-10 border-t border-gray-200"></div>

        <!-- Generate Admin Password Section -->
       <div class="bg-white p-6 rounded-md shadow hover:shadow-md transition-shadow duration-200 border-gradient-to-r from-indigo-500 to-purple-600">
  <div class="text-lg font-semibold text-gray-800 flex items-center gap-2 bg-white/80 shadow-sm rounded-md p-2 animate-fade-in-up">
    <mat-icon class="icon-size-5 text-indigo-600 animate-pulse" [svgIcon]="'heroicons_solid:user-group'"></mat-icon>
    Generate Admin Password
  </div>
  <div class="text-gray-500 text-sm mt-1">Reset an adminâ€™s password securely if they lose access.</div>
  <div class="flex flex-col gap-4 mt-4">
    <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
      <mat-label class="text-gray-700 text-sm">Admin</mat-label>
      <mat-icon class="icon-size-5 text-indigo-500 animate-pulse" [svgIcon]="'heroicons_solid:user'" matPrefix></mat-icon>
      <mat-select [formControlName]="'AdminId'" class="text-sm">
        <!-- Add search input -->
        <ngx-mat-select-search
          [formControl]="adminFilterCtrl"
          placeholderLabel="Search for an admin..."
          noEntriesFoundLabel="No results found"
        ></ngx-mat-select-search>
        <mat-option *ngFor="let admin of filteredAdmins" [value]="admin.id">
          {{ admin.username }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="securityForm.get('AdminId')?.hasError('required') && securityForm.get('AdminId')?.touched" class="text-sm">
        Required
      </mat-error>
    </mat-form-field>
    <div class="w-full">
      <div class="border border-gray-200 rounded-md p-4 bg-gray-50 flex justify-between items-center hover:bg-gray-100 transition-all duration-200">
        <div class="flex items-center">
          <mat-icon class="icon-size-5 text-indigo-500 animate-pulse" [svgIcon]="'heroicons_solid:key'"></mat-icon>
          <span class="text-gray-800 text-sm ml-2">{{ generatedPassword || 'Generate a new password' }}</span>
        </div>
        <button
          class="text-indigo-600 hover:text-indigo-800 transition duration-200"
          (click)="copyToClipboardadmin(generatedPassword)"
          matTooltip="Copy to clipboard"
        >
          <mat-icon class="icon-size-4" [svgIcon]="'heroicons_solid:clipboard'"></mat-icon>
        </button>
      </div>
    </div>
  </div>
  <div class="flex items-center justify-end mt-4">
    <button
      mat-flat-button
      type="button"
      class="px-4 py-2 bg-indigo-600 text-white hover:bg-indigo-700 transition duration-200 text-sm"
      [disabled]="!securityForm.get('AdminId')?.value"
      (click)="onGenerateRandomPasswordadmin()"
    >
      Generate
    </button>
  </div>
  <div *ngIf="successMessageadmi" class="mt-2 text-green-600 text-sm">{{ successMessageadmi }}</div>
  <div *ngIf="errorMessageadmi" class="mt-2 text-red-600 text-sm">{{ errorMessageadmi }}</div>
</div>
    </form>
</div>

